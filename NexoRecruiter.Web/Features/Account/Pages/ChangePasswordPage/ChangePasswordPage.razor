@page "/auth/change-password"
@using System.Reflection.Metadata
@using Microsoft.AspNetCore.Identity
@using NexoRecruiter.Application.DTOs.Auth
@using NexoRecruiter.Application.Services.Auth
@using NexoRecruiter.Domain.Repositories.Auth
@using NexoRecruiter.Domain.Repositories.Auth.ValueObjects
@using NexoRecruiter.Web.Features.Account.ViewModels
@using NexoRecruiter.Web.Features.Auth.Models
@using NexoRecruiter.Web.Features.Dashboard.Layouts.DashboardLayout
@inject IUserService userManager
@inject ISnackbar Snackbar
@inject NavigationManager navigationManager

@layout DashboardLayout
@attribute [Authorize]

<MudContainer Class="nexo-change-password">
    <MudText Class="nexo-change-password__text-title" Typo="Typo.h5" Align="Align.Start" Color="Color.Secondary">
        Change Password
    </MudText>

    <MudPaper Class="nexo-change-password__container">
        <MudCard Elevation="0" class="nexo-change-password__login-card">
            @if (isLoading)
            {
                <MudProgressLinear Indeterminate="true" Class="mb-4" />
                <MudText Align="Align.Center">...</MudText>
            }
            else
            {
                <EditForm Model="resetForm" OnValidSubmit="SubmitResetPassword" Class="d-flex flex-column gap-5">
                    <DataAnnotationsValidator />
                    <div>
                        <MudText Color=Color.Secondary Class="nexo-change-password__card-label">Current Password</MudText>
                        <MudTextField Class="nexo-change-password__input" @bind-Value="resetForm.CurrentPassword"
                                      Variant="Variant.Outlined" InputType="showCurrentPassword? InputType.Text: InputType.Password"
                                      Placeholder="••••••••" For="@(() => resetForm.CurrentPassword)" Disabled="isSubmitting"
                                      AdornmentIcon="showCurrentPassword ? Icons.Material.Filled.Visibility : Icons.Material.Filled.VisibilityOff"
                                      OnAdornmentClick="ToggleShowCurrentPassword" AdornmentColor="Color.Primary"
                                      Adornment="Adornment.End" />
                        <ValidationMessage For="@(() => resetForm.CurrentPassword)" />
                    </div>

                    <div>
                        <MudText Color=Color.Secondary Class="nexo-change-password__card-label">New Password</MudText>
                        <MudTextField Class="nexo-change-password__input" @bind-Value="resetForm.NewPassword"
                                      Variant="Variant.Outlined" InputType="showNewPassword? InputType.Text: InputType.Password"
                                      Placeholder="••••••••" For="@(() => resetForm.NewPassword)" Disabled="isSubmitting"
                                      AdornmentIcon="showNewPassword ? Icons.Material.Filled.Visibility : Icons.Material.Filled.VisibilityOff"
                                      OnAdornmentClick="ToggleShowNewPassword" AdornmentColor="Color.Primary"
                                      Adornment="Adornment.End" />
                        <ValidationMessage For="@(() => resetForm.NewPassword)" />
                    </div>

                    <div>
                        <MudText Color=Color.Secondary Class="nexo-change-password__card-label">Confirm Password</MudText>
                        <MudTextField Class="nexo-change-password__input" @bind-Value="resetForm.ConfirmPassword"
                                      Variant="Variant.Outlined" InputType="showConfirmPassword? InputType.Text: InputType.Password"
                                      Placeholder="••••••••" For="@(() => resetForm.ConfirmPassword)" Disabled="isSubmitting"
                                      AdornmentIcon="showConfirmPassword ? Icons.Material.Filled.Visibility : Icons.Material.Filled.VisibilityOff"
                                      OnAdornmentClick="ToggleShowConfirmPassword" AdornmentColor="Color.Primary"
                                      Adornment="Adornment.End" />
                        <ValidationMessage For="@(() => resetForm.ConfirmPassword)" />
                    </div>

                    <MudButton Variant="Variant.Filled" Color="Color.Primary" ButtonType="ButtonType.Submit"
                               FullWidth="true" Disabled="isSubmitting">
                        Reset Password
                    </MudButton>
                </EditForm>
            }
        </MudCard>
    </MudPaper>
</MudContainer>

<form @ref="logoutForm" method="post" action="@AppRoutes.Logout" id="logout-form" style="display: none;">
    <AntiforgeryToken />
    <input type="hidden" name="returnUrl" value="@AppRoutes.Login" />
</form>
