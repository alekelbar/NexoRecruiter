@using NexoRecruiter.Web.Features.Dashboard.Helpers
@inject NavigationManager navigationManager

<MudAppBar Color="Color.Transparent" Fixed Elevation="0">

    @if (isDashboard)
    {
        <MudText Class="mr-1" Typo="Typo.body1">Hello @(CurrentUser?.FullName ?? "")</MudText>
    }

    <MudIconButton OnClick="drawerController!.Toggle"
                   Icon="@(drawerController.IsOpen ? Icons.Material.Filled.KeyboardDoubleArrowLeft: Icons.Material.Filled.KeyboardDoubleArrowRight)"
                   aria-label="Open Drawer" />
    <MudText Typo="Typo.caption">@DateTime.Now.ToString("MMMM dd, yyyy")</MudText>
    <MudSpacer />
</MudAppBar>

@code {
    [CascadingParameter(Name = "CurrentUser")]
    public ApplicationUser? CurrentUser { get; set; }
    [CascadingParameter(Name = "CurrentRoles")]
    public string? CurrentRoles { get; set; }
    public bool isDashboard = false;
    [Parameter]
    public DrawerController? drawerController { get; set; }

    protected override void OnInitialized()
    {
        navigationManager.LocationChanged += OnLocationChanged;
        UpdateDashboardState();
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        UpdateDashboardState();
        StateHasChanged();
    }

    private void UpdateDashboardState()
    {
        var relativePath = navigationManager.ToBaseRelativePath(navigationManager.Uri);
        Console.WriteLine($"URL relativa: {relativePath}");
        isDashboard = relativePath.Contains("dashboard");
    }

    public void Dispose()
    {
        navigationManager.LocationChanged -= OnLocationChanged;
    }
}