@using Microsoft.AspNetCore.Components
@using NexoRecruiter.Web.Features.Dashboard.Components
@using NexoRecruiter.Web.Features.Dashboard.Helpers
@using NexoRecruiter.Web.Features.Shared.Components
@using System.Reflection.Metadata

@implements ILayoutHeadHost
@inherits LayoutComponentBase

<CascadingValue Value="this" IsFixed Name="DashboardLayout">
    <HeadContent>
        @pageHead
    </HeadContent>
    <AppShell>
        <MudLayout Class="dashboard">
            <CascadingValue Value="_drawerController">
                <NexoAppbar drawerController="_drawerController" />
                <NexoDrawer IsOpen="_drawerController.IsOpen" Toggle="_drawerController.Toggle" />
                <MudMainContent>
                    <MudStack Row>
                        <MudBreadcrumbs Items="_breadcrumbItems" />
                    </MudStack>
                    @Body
                </MudMainContent>
            </CascadingValue>
        </MudLayout>
    </AppShell>
</CascadingValue>

@code {
    private List<BreadcrumbItem> _breadcrumbItems = new() {
        new("Home", "/dashboard"),
    };

    public void setCurrentPage(string currentPage, string path)
    {
        if (_breadcrumbItems.Count > 1) _breadcrumbItems.RemoveAt(1);
        _breadcrumbItems.Add(new BreadcrumbItem(text: currentPage, path));
        StateHasChanged();
    }

    private RenderFragment? pageHead;
    public DrawerController _drawerController = new();

    public void SetPageHead(RenderFragment? fragment)
    {
        pageHead = fragment;
        StateHasChanged();
    }

    public void ClearPageHead()
    {
        pageHead = null;
        StateHasChanged();
    }

    protected override void OnInitialized()
    {
        _drawerController.OnChange += () => InvokeAsync(StateHasChanged);
    }
}