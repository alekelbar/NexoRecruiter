@page "/auth/reset-password"
@using System.Text
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.WebUtilities
@using NexoRecruiter.Application.DTOs.Auth
@using NexoRecruiter.Application.Services.Auth
@using NexoRecruiter.Domain.Repositories.Auth
@using NexoRecruiter.Web.Features.Auth.Layouts.AuthLayout
@using NexoRecruiter.Web.Features.Auth.Models

@attribute [AllowAnonymous]
@layout AuthLayout

<MudPaper Class="nexo-reset-password">
    <MudCard Elevation="0" class="nexo-reset-password__login-card">
        <MudImage Class="nexo-reset-password__icon" Src="@Assets["images/logo-login.png"]"></MudImage>
        @if (isLoading)
        {
            <MudProgressLinear Indeterminate="true" Class="mb-4" />
            <MudText Align="Align.Center">Validating token...</MudText>
        }
        else if (!isTokenValid)
        {
            <MudAlert Severity="Severity.Error" Class="mb-4">
                Invalid or expired reset link. Please request a new one.
            </MudAlert>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true"
                       Href="@AppRoutes.RequestResetPassword">
                Request New Link
            </MudButton>
        }
        else
        {
            <MudPaper Elevation="0" Class="nexo-reset-password__text">
                <MudText Class="nexo-reset-password__text-title" Typo="Typo.h5" Align="Align.Center">
                    Reset Password
                </MudText>
            </MudPaper>

            <EditForm Model="resetForm" OnValidSubmit="SubmitResetPassword" Class="d-flex flex-column gap-5">
                <DataAnnotationsValidator />

                <div>
                    <MudText Class="nexo-reset-password__card-label">New Password</MudText>
                    <MudTextField Class="nexo-reset-password__input" @bind-Value="resetForm.NewPassword"
                                  Variant="Variant.Outlined" InputType="InputType.Password" Placeholder="••••••••"
                                  For="@(() => resetForm.NewPassword)" Disabled="isSubmitting" />
                    <ValidationMessage For="@(() => resetForm.NewPassword)" />
                </div>

                <div>
                    <MudText Class="nexo-reset-password__card-label">Confirm Password</MudText>
                    <MudTextField Class="nexo-reset-password__input" @bind-Value="resetForm.ConfirmPassword"
                                  Variant="Variant.Outlined" InputType="InputType.Password" Placeholder="••••••••"
                                  For="@(() => resetForm.ConfirmPassword)" Disabled="isSubmitting" />
                    <ValidationMessage For="@(() => resetForm.ConfirmPassword)" />
                </div>

                <MudButton Variant="Variant.Filled" Color="Color.Primary" ButtonType="ButtonType.Submit" FullWidth="true"
                           Disabled="isSubmitting">
                    Reset Password
                </MudButton>
            </EditForm>
        }
    </MudCard>
</MudPaper>
